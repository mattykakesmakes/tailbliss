<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
{{ partial "meta" . }}

{{/* DNS prefetch and preconnect for external resources */}}
<link href="//cdn.jsdelivr.net" rel="dns-prefetch">
<link href="https://cdn.jsdelivr.net" rel="preconnect" crossorigin="anonymous">
{{/* Cloudflare Insights prefetch - Note: StorageType.persistent warnings in console 
     are from Cloudflare's automatic injection and cannot be controlled by theme */}}
<link href="https://static.cloudflareinsights.com" rel="preconnect" rel="dns-prefetch">
<link href="https://static.cloudflareinsights.com" crossorigin="anonymous" rel="preconnect">

{{/* Preload critical hero image for better LCP performance */}}
{{ if .IsHome }}
{{ $heroImage := resources.Get "images/pages/tailbliss-rocket-indigo.png" }}
{{ if $heroImage }}
{{ $heroWebP := $heroImage.Resize "576x576 webp q85" }}
<link href="{{ $heroWebP.RelPermalink }}" rel="preload" as="image" fetchpriority="high" loading="eager">
{{ else }}
<link as="image" href="/images/tailbliss-rocket-indigo.webp" rel="preload" fetchpriority="high" loading="eager">
{{ end }}
{{ end }}

{{/* Preload critical navigation logo to prevent CLS */}}
<link href="/images/site-logo.svg" rel="preload" as="image" fetchpriority="high" loading="eager">

{{/* Preload Alpine.js script for better performance */}}
<link href="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js" as="script" rel="preconnect" rel="dns-prefetch">

{{/* Hide Alpine.js [x-cloak] elements until Alpine initializes to prevent nav menu flicker.
The x-cloak directive is located in the head partial to prevent rollup from Vite. */}}
<style>
  [x-cloak] {
    display: none !important;
  }
</style>

<script>
  // On page load or when changing themes, best to add inline in `head` to avoid FOUC
  if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark')
  }
</script>
{{/* Use Vite-generated CSS files with cache busting hashes */}}
{{ $cssFiles := readDir "themes/tailbliss/static/css" }}
{{ $mainCSS := "" }}

{{/* Find the hashed main CSS file */}}
{{ range $cssFiles }}
{{ if strings.Contains .Name "main." }}
{{ if strings.HasSuffix .Name ".css" }}
{{ $mainCSS = .Name }}
{{ end }}
{{ end }}
{{ end }}

{{ if $mainCSS }}
{{/* Load CSS normally for better CLS prevention */}}
<link rel="stylesheet" href="/css/{{ $mainCSS }}">
{{ else }}
{{/* Fallback to Hugo PostCSS processing if Vite file not found */}}
{{ $styles := resources.Get "css/main.css" }}
{{ if $styles }}
{{ $styles := $styles | postCSS }}
{{ if hugo.IsProduction }}
{{ $styles := $styles | minify | fingerprint | resources.PostProcess }}
{{ end }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
{{ else }}
{{/* Final fallback - try to load from theme assets */}}
{{ $styles := resources.Get "css/main.css" }}
{{ if $styles }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
{{ end }}
{{ end }}
{{ end }}